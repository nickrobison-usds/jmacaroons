language: java
jdk:
  - openjdk8
  - oraclejdk11

before_install:
  - echo -n | openssl s_client -connect scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-
  - wget https://github.com/fuzzitdev/fuzzit/releases/latest/download/fuzzit_Linux_x86_64 -O fuzzit
  - chmod a+x fuzzit

addons:
  coverity_scan:
    project:
      name: "nickrobison-usds/jmacaroons"
      description: "Java based Macaroon implementation"
    notification_email: nicholas.a.robison@omb.eop.gov
#    build_command_prepend: "<Your build preprocessing command here>"
    build_command: "mvn -DskipTests clean compile"
    branch_pattern: coverity

after_script:
  - ./fuzzit create job --engine jqf --type fuzzing --args "com.github.nitram509.jmacaroons.FuzzTest base64RoundTrip" nickrobison-usds-gh/jmacaroons jmacaroons-fuzz/target/fuzzing-fat-tests.jar

after_success:
  - mvn clean cobertura:cobertura coveralls:cobertura
